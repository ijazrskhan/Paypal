<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPal & PKR Transaction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .table-hover tbody tr:hover {
            background-color: #f8fafc;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 fade-in">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-lock text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Admin Login</h2>
                <p class="text-gray-600 mt-2">Please enter your credentials</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter username">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter password">
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 px-4 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </form>
            <div class="mt-4 text-center">
                <button id="guestLoginBtn" class="text-blue-600 hover:text-blue-800 text-sm">
                    <i class="fas fa-eye mr-1"></i>Continue as Guest (Read-only)
                </button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold">Transaction Dashboard</h1>
                            <p class="text-blue-100">PayPal & PKR Management System</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm text-blue-100">Welcome back</p>
                            <p class="font-semibold" id="userRole">Admin</p>
                        </div>
                        <button id="logoutBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Total USD</p>
                            <p class="text-2xl font-bold text-green-600" id="totalUSD">$0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-dollar-sign text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">Total PKR</p>
                            <p class="text-2xl font-bold text-blue-600" id="totalPKR">â‚¨0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-rupee-sign text-blue-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">USD Transactions</p>
                            <p class="text-2xl font-bold text-purple-600" id="usdCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fab fa-paypal text-purple-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">PKR Transactions</p>
                            <p class="text-2xl font-bold text-orange-600" id="pkrCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-coins text-orange-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PayPal USD Section -->
            <div class="bg-white rounded-xl card-shadow mb-8">
                <div class="border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800">
                            <i class="fab fa-paypal text-blue-600 mr-2"></i>PayPal USD Transactions
                        </h2>
                        <div class="flex space-x-2">
                            <button id="exportUSDBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                                <i class="fas fa-file-excel mr-2"></i>Export USD
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- USD Form -->
                <div id="usdForm" class="p-6 border-b border-gray-200">
                    <form id="usdTransactionForm">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                                <input type="text" id="usdClientName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">USD Amount</label>
                                <input type="number" id="usdAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Exchange Rate</label>
                                <input type="number" id="exchangeRate" value="255" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total PKR</label>
                                <input type="number" id="usdTotalPKR" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add USD Transaction
                        </button>
                    </form>
                </div>

                <!-- USD Table -->
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Transaction History</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="usdSearch" placeholder="Search transactions..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <select id="usdSort" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="date">Sort by Date</option>
                                <option value="client">Sort by Client</option>
                                <option value="amount">Sort by Amount</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full table-hover">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">USD Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exchange Rate</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PKR Total</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider admin-only">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usdTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- USD transactions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PKR Section -->
            <div class="bg-white rounded-xl card-shadow">
                <div class="border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-rupee-sign text-green-600 mr-2"></i>PKR Transactions
                        </h2>
                        <div class="flex space-x-2">
                            <button id="exportPKRBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
                                <i class="fas fa-file-excel mr-2"></i>Export PKR
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- PKR Form -->
                <div id="pkrForm" class="p-6 border-b border-gray-200">
                    <form id="pkrTransactionForm">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                                <input type="text" id="pkrClientName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">PKR Amount</label>
                                <input type="number" id="pkrAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Purpose/Note</label>
                                <input type="text" id="pkrPurpose" placeholder="e.g., Cash received, Mobile top-up" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add PKR Transaction
                        </button>
                    </form>
                </div>

                <!-- PKR Table -->
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Transaction History</h3>
                        <div class="flex space-x-2">
                            <input type="text" id="pkrSearch" placeholder="Search transactions..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <select id="pkrSort" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="date">Sort by Date</option>
                                <option value="client">Sort by Client</option>
                                <option value="amount">Sort by Amount</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full table-hover">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PKR Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purpose</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider admin-only">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pkrTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- PKR transactions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold mb-4">Edit Transaction</h3>
            <form id="editForm">
                <div id="editFormFields">
                    <!-- Dynamic form fields will be populated here -->
                </div>
                <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" id="cancelEdit" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application state
        let isAdmin = false;
        let currentUser = '';
        let usdTransactions = JSON.parse(localStorage.getItem('usdTransactions')) || [];
        let pkrTransactions = JSON.parse(localStorage.getItem('pkrTransactions')) || [];
        let editingTransaction = null;

        // DOM elements
        const loginModal = document.getElementById('loginModal');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const guestLoginBtn = document.getElementById('guestLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userRole = document.getElementById('userRole');

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                isAdmin = userData.isAdmin;
                currentUser = userData.username;
                showDashboard();
            }

            setupEventListeners();
            updateStats();
        });

        // Event listeners
        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);
            guestLoginBtn.addEventListener('click', handleGuestLogin);
            logoutBtn.addEventListener('click', handleLogout);

            // Transaction forms
            document.getElementById('usdTransactionForm').addEventListener('submit', handleUSDTransaction);
            document.getElementById('pkrTransactionForm').addEventListener('submit', handlePKRTransaction);

            // Auto-calculate PKR total
            document.getElementById('usdAmount').addEventListener('input', calculatePKRTotal);
            document.getElementById('exchangeRate').addEventListener('input', calculatePKRTotal);

            // Search and sort
            document.getElementById('usdSearch').addEventListener('input', () => filterTransactions('usd'));
            document.getElementById('pkrSearch').addEventListener('input', () => filterTransactions('pkr'));
            document.getElementById('usdSort').addEventListener('change', () => sortTransactions('usd'));
            document.getElementById('pkrSort').addEventListener('change', () => sortTransactions('pkr'));

            // Export buttons
            document.getElementById('exportUSDBtn').addEventListener('click', () => exportToExcel('usd'));
            document.getElementById('exportPKRBtn').addEventListener('click', () => exportToExcel('pkr'));

            // Edit modal
            document.getElementById('cancelEdit').addEventListener('click', closeEditModal);
            document.getElementById('editForm').addEventListener('submit', handleEditSubmit);
        }

        // Login handling
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Hardcoded credentials
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                currentUser = 'admin';
                localStorage.setItem('currentUser', JSON.stringify({ username: 'admin', isAdmin: true }));
                showDashboard();
            } else {
                alert('Invalid credentials! Use: admin/admin123');
            }
        }

        function handleGuestLogin() {
            isAdmin = false;
            currentUser = 'guest';
            localStorage.setItem('currentUser', JSON.stringify({ username: 'guest', isAdmin: false }));
            showDashboard();
        }

        function handleLogout() {
            localStorage.removeItem('currentUser');
            isAdmin = false;
            currentUser = '';
            loginModal.classList.remove('hidden');
            dashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginModal.classList.add('hidden');
            dashboard.classList.remove('hidden');
            userRole.textContent = isAdmin ? 'Admin' : 'Guest (Read-only)';
            
            // Show/hide admin-only elements
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => {
                el.style.display = isAdmin ? 'block' : 'none';
            });

            const forms = document.querySelectorAll('#usdForm, #pkrForm');
            forms.forEach(form => {
                form.style.display = isAdmin ? 'block' : 'none';
            });

            renderTransactions();
            updateStats();
        }

        // Transaction handling
        function handleUSDTransaction(e) {
            e.preventDefault();
            if (!isAdmin) return;

            const transaction = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                clientName: document.getElementById('usdClientName').value,
                usdAmount: parseFloat(document.getElementById('usdAmount').value),
                exchangeRate: parseFloat(document.getElementById('exchangeRate').value),
                pkrTotal: parseFloat(document.getElementById('usdTotalPKR').value)
            };

            usdTransactions.push(transaction);
            localStorage.setItem('usdTransactions', JSON.stringify(usdTransactions));
            
            // Reset form
            document.getElementById('usdTransactionForm').reset();
            document.getElementById('exchangeRate').value = '255';
            document.getElementById('usdTotalPKR').value = '';
            
            renderTransactions();
            updateStats();
        }

        function handlePKRTransaction(e) {
            e.preventDefault();
            if (!isAdmin) return;

            const transaction = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                clientName: document.getElementById('pkrClientName').value,
                pkrAmount: parseFloat(document.getElementById('pkrAmount').value),
                purpose: document.getElementById('pkrPurpose').value || 'N/A'
            };

            pkrTransactions.push(transaction);
            localStorage.setItem('pkrTransactions', JSON.stringify(pkrTransactions));
            
            // Reset form
            document.getElementById('pkrTransactionForm').reset();
            
            renderTransactions();
            updateStats();
        }

        function calculatePKRTotal() {
            const usdAmount = parseFloat(document.getElementById('usdAmount').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
            const pkrTotal = usdAmount * exchangeRate;
            document.getElementById('usdTotalPKR').value = pkrTotal.toFixed(2);
        }

        // Render transactions
        function renderTransactions() {
            renderUSDTransactions();
            renderPKRTransactions();
        }

        function renderUSDTransactions() {
            const tbody = document.getElementById('usdTableBody');
            tbody.innerHTML = '';

            usdTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.clientName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$${transaction.usdAmount.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.exchangeRate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚¨${transaction.pkrTotal.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 admin-only" style="display: ${isAdmin ? 'block' : 'none'}">
                        <button onclick="editTransaction('usd', ${transaction.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTransaction('usd', ${transaction.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPKRTransactions() {
            const tbody = document.getElementById('pkrTableBody');
            tbody.innerHTML = '';

            pkrTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.clientName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚¨${transaction.pkrAmount.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.purpose}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 admin-only" style="display: ${isAdmin ? 'block' : 'none'}">
                        <button onclick="editTransaction('pkr', ${transaction.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTransaction('pkr', ${transaction.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Edit/Delete transactions
        function editTransaction(type, id) {
            if (!isAdmin) return;

            const transactions = type === 'usd' ? usdTransactions : pkrTransactions;
            const transaction = transactions.find(t => t.id === id);
            
            if (!transaction) return;

            editingTransaction = { type, id, transaction };
            
            const modal = document.getElementById('editModal');
            const formFields = document.getElementById('editFormFields');
            
            if (type === 'usd') {
                formFields.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                        <input type="text" id="editClientName" value="${transaction.clientName}" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">USD Amount</label>
                        <input type="number" id="editUSDAmount" value="${transaction.usdAmount}" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Exchange Rate</label>
                        <input type="number" id="editExchangeRate" value="${transaction.exchangeRate}" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                `;
            } else {
                formFields.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                        <input type="text" id="editClientName" value="${transaction.clientName}" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">PKR Amount</label>
                        <input type="number" id="editPKRAmount" value="${transaction.pkrAmount}" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Purpose</label>
                        <input type="text" id="editPurpose" value="${transaction.purpose}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        function handleEditSubmit(e) {
            e.preventDefault();
            if (!isAdmin || !editingTransaction) return;

            const { type, id } = editingTransaction;
            const transactions = type === 'usd' ? usdTransactions : pkrTransactions;
            const index = transactions.findIndex(t => t.id === id);
            
            if (index === -1) return;

            if (type === 'usd') {
                const usdAmount = parseFloat(document.getElementById('editUSDAmount').value);
                const exchangeRate = parseFloat(document.getElementById('editExchangeRate').value);
                
                transactions[index] = {
                    ...transactions[index],
                    clientName: document.getElementById('editClientName').value,
                    usdAmount: usdAmount,
                    exchangeRate: exchangeRate,
                    pkrTotal: usdAmount * exchangeRate
                };
            } else {
                transactions[index] = {
                    ...transactions[index],
                    clientName: document.getElementById('editClientName').value,
                    pkrAmount: parseFloat(document.getElementById('editPKRAmount').value),
                    purpose: document.getElementById('editPurpose').value || 'N/A'
                };
            }

            localStorage.setItem(type === 'usd' ? 'usdTransactions' : 'pkrTransactions', JSON.stringify(transactions));
            
            closeEditModal();
            renderTransactions();
            updateStats();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            editingTransaction = null;
        }

        function deleteTransaction(type, id) {
            if (!isAdmin) return;
            
            if (confirm('Are you sure you want to delete this transaction?')) {
                if (type === 'usd') {
                    usdTransactions = usdTransactions.filter(t => t.id !== id);
                    localStorage.setItem('usdTransactions', JSON.stringify(usdTransactions));
                } else {
                    pkrTransactions = pkrTransactions.filter(t => t.id !== id);
                    localStorage.setItem('pkrTransactions', JSON.stringify(pkrTransactions));
                }
                
                renderTransactions();
                updateStats();
            }
        }

        // Search and sort
        function filterTransactions(type) {
            const searchTerm = document.getElementById(`${type}Search`).value.toLowerCase();
            const transactions = type === 'usd' ? usdTransactions : pkrTransactions;
            
            const filtered = transactions.filter(transaction => 
                transaction.clientName.toLowerCase().includes(searchTerm) ||
                transaction.date.includes(searchTerm) ||
                (type === 'pkr' && transaction.purpose.toLowerCase().includes(searchTerm))
            );
            
            renderFilteredTransactions(type, filtered);
        }

        function sortTransactions(type) {
            const sortBy = document.getElementById(`${type}Sort`).value;
            const transactions = type === 'usd' ? [...usdTransactions] : [...pkrTransactions];
            
            transactions.sort((a, b) => {
                switch (sortBy) {
                    case 'date':
                        return new Date(b.date) - new Date(a.date);
                    case 'client':
                        return a.clientName.localeCompare(b.clientName);
                    case 'amount':
                        const amountA = type === 'usd' ? a.usdAmount : a.pkrAmount;
                        const amountB = type === 'usd' ? b.usdAmount : b.pkrAmount;
                        return amountB - amountA;
                    default:
                        return 0;
                }
            });
            
            renderFilteredTransactions(type, transactions);
        }

        function renderFilteredTransactions(type, transactions) {
            const tbody = document.getElementById(`${type}TableBody`);
            tbody.innerHTML = '';

            transactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                if (type === 'usd') {
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.clientName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$${transaction.usdAmount.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.exchangeRate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚¨${transaction.pkrTotal.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 admin-only" style="display: ${isAdmin ? 'block' : 'none'}">
                            <button onclick="editTransaction('usd', ${transaction.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('usd', ${transaction.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.clientName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚¨${transaction.pkrAmount.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.purpose}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 admin-only" style="display: ${isAdmin ? 'block' : 'none'}">
                            <button onclick="editTransaction('pkr', ${transaction.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('pkr', ${transaction.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                }
                
                tbody.appendChild(row);
            });
        }

        // Export to Excel
        function exportToExcel(type) {
            const transactions = type === 'usd' ? usdTransactions : pkrTransactions;
            
            if (transactions.length === 0) {
                alert('No transactions to export');
                return;
            }

            let data;
            if (type === 'usd') {
                data = transactions.map(t => ({
                    Date: t.date,
                    'Client Name': t.clientName,
                    'USD Amount': t.usdAmount,
                    'Exchange Rate': t.exchangeRate,
                    'PKR Total': t.pkrTotal
                }));
            } else {
                data = transactions.map(t => ({
                    Date: t.date,
                    'Client Name': t.clientName,
                    'PKR Amount': t.pkrAmount,
                    Purpose: t.purpose
                }));
            }

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, type === 'usd' ? 'USD Transactions' : 'PKR Transactions');
            
            const filename = `${type.toUpperCase()}_Transactions_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        // Update statistics
        function updateStats() {
            const totalUSD = usdTransactions.reduce((sum, t) => sum + t.usdAmount, 0);
            const totalPKR = pkrTransactions.reduce((sum, t) => sum + t.pkrAmount, 0);
            const usdPKRTotal = usdTransactions.reduce((sum, t) => sum + t.pkrTotal, 0);
            
            document.getElementById('totalUSD').textContent = `$${totalUSD.toFixed(2)}`;
            document.getElementById('totalPKR').textContent = `â‚¨${(totalPKR + usdPKRTotal).toFixed(2)}`;
            document.getElementById('usdCount').textContent = usdTransactions.length;
            document.getElementById('pkrCount').textContent = pkrTransactions.length;
        }
    </script>
</body>
</html>
